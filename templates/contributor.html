<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Contributor Details - {{ username }}</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="/static/css/contributor.css" rel="stylesheet">
</head>
<body>
    <a href="javascript:history.back()" class="back-button">
        <i class="fas fa-arrow-left me-2"></i>Back
    </a>

    <div class="container py-5">
        <div class="contributor-header">
            <img src="https://ui-avatars.com/api/?name={{ username }}&background=random" 
                 alt="{{ username }}" 
                 class="contributor-avatar">
            <h1 class="page-title">{{ username }}</h1>
            <h4 class="text-muted">Contributions to {{ page_title }}</h4>
        </div>

        <div id="changes-list" class="row"></div>
    </div>

    <script>
        async function loadContributorChanges() {
            try {
                const response = await fetch(`/api/contributor/{{ page_title }}/${encodeURIComponent('{{ username }}')}`)
                const changes = await response.json();
                
                const changesList = document.getElementById('changes-list');
                changes.forEach(change => {
                    const changeCard = document.createElement('div');
                    changeCard.className = 'col-12';
                    changeCard.innerHTML = `
                        <div class="change-card">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h5>${new Date(change.timestamp).toLocaleString()}</h5>
                                    <p class="text-muted">${change.comment || 'No comment provided'}</p>
                                </div>
                                <span class="badge bg-${change.sizediff > 0 ? 'success' : 'danger'}">
                                    ${change.sizediff > 0 ? '+' : ''}${change.sizediff} bytes
                                </span>
                            </div>
                            <div class="diff-view">
                                ${formatDiff(change.diff)}
                            </div>
                        </div>
                    `;
                    changesList.appendChild(changeCard);
                });
            } catch (error) {
                console.error('Error loading changes:', error);
            }
        }

        function formatDiff(diff) {
            // Simple diff formatting - you might want to enhance this
            return diff.split('\n').map(line => {
                if (line.startsWith('+')) {
                    return `<span class="diff-added">${line}</span>`;
                } else if (line.startsWith('-')) {
                    return `<span class="diff-removed">${line}</span>`;
                }
                return line;
            }).join('<br>');
        }

        document.addEventListener('DOMContentLoaded', loadContributorChanges);
    </script>

    <!-- Add the same background animations as indexpage -->
    <script>
        function createWikiSymbols() {
            const container = document.createElement('div');
            container.className = 'wiki-symbols';
            
            for (let i = 0; i < 20; i++) {
                const symbol = document.createElement('div');
                symbol.className = 'wiki-symbol';
                symbol.textContent = 'W';
                symbol.style.left = `${Math.random() * 100}%`;
                symbol.style.animationDelay = `${Math.random() * 15}s`;
                container.appendChild(symbol);
            }
            
            document.body.appendChild(container);
        }

        document.addEventListener('DOMContentLoaded', createWikiSymbols);
    </script>
</body>
</html>
